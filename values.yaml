---
clusterName: "elasticsearch"
nodeGroup: "master"

masterService: "elasticsearch-master"

roles:
  - master
  - data
  - data_content
  - data_hot
  - data_warm
  - data_cold
  - ingest
  - remote_cluster_client
  - transform

replicas: 1

esMajorVersion: ""

esConfig:
  elasticsearch.yml: |
    cluster.name: elasticsearch
    node.name: ${HOSTNAME}

    network.host: 0.0.0.0

    discovery.seed_hosts:
      - elasticsearch-master-headless

    cluster.initial_master_nodes:
      - elasticsearch-master-0

    xpack.security.enabled: true
    xpack.security.enrollment.enabled: true

    xpack.security.transport.ssl.enabled: true
    xpack.security.transport.ssl.verification_mode: certificate
    xpack.security.transport.ssl.key: /usr/share/elasticsearch/config/certs/tls.key
    xpack.security.transport.ssl.certificate: /usr/share/elasticsearch/config/certs/tls.crt
    xpack.security.transport.ssl.certificate_authorities:
      - /usr/share/elasticsearch/config/certs/ca.crt

    xpack.security.http.ssl.enabled: true
    xpack.security.http.ssl.key: /usr/share/elasticsearch/config/certs/tls.key
    xpack.security.http.ssl.certificate: /usr/share/elasticsearch/config/certs/tls.crt
    xpack.security.http.ssl.certificate_authorities:
      - /usr/share/elasticsearch/config/certs/ca.crt

createCert: true

secret:
  enabled: true
  password: ""

image: "docker.elastic.co/elasticsearch/elasticsearch"
imageTag: "8.12.0"
imagePullPolicy: "IfNotPresent"

resources:
  requests:
    cpu: "500m"
    memory: "1Gi"
  limits:
    cpu: "1"
    memory: "2Gi"

volumeClaimTemplate:
  accessModes:
    - ReadWriteOnce
  resources:
    requests:
      storage: 30Gi

persistence:
  enabled: true
  labels:
    enabled: false

rbac:
  create: false

podSecurityPolicy:
  create: false   # ðŸ”¥ REQUIRED to avoid Helm nil pointer

podSecurityContext:
  fsGroup: 1000
  runAsUser: 1000

securityContext:
  runAsNonRoot: true
  runAsUser: 1000
  capabilities:
    drop:
      - ALL

sysctlVmMaxMapCount: 262144

readinessProbe:
  failureThreshold: 3
  initialDelaySeconds: 10
  periodSeconds: 10
  successThreshold: 3
  timeoutSeconds: 5

clusterHealthCheckParams: "wait_for_status=yellow&timeout=5s"

protocol: https
httpPort: 9200
transportPort: 9300

service:
  enabled: true
  type: ClusterIP
  publishNotReadyAddresses: false

antiAffinityTopologyKey: "kubernetes.io/hostname"
antiAffinity: "hard"

podManagementPolicy: "OrderedReady"

enableServiceLinks: false

terminationGracePeriod: 120

sysctlInitContainer:
  enabled: true

tests:
  enabled: true
